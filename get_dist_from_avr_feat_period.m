function out =  get_dist_from_avr_feat_period(feat)
% Input:
%   feat   - extracted features of 1 period (31 x 1)
% Output:
%   out    - sqi of the period
%
% ---------------------------------------------------------
%
% Released under MIT license.  
% Copyright (c) 2021 Anna Ignácz, Sándor Földi, Péter Sótonyi, György Cserey
% For any comment or bug report, please send e-mail to: anna.ignacz95@gmail.com
%
    
    if sum(feat == 0) > 25
        out = 0;
    else
        
        % Normalize the features with means and standard deviation
        % calculated during the training. Defined seperately for each
        % period.
        means = [0.102371487588135,0.204523827914477,NaN,NaN,-0.204523827914477,0.147380000000000,NaN,0.461789215706015,1,NaN,NaN,2.89193157877567,0.0624033317946260,0.0386761043751306,0.0355601476769672,0.0904918357957830,0.0112992073033031,0.000166548856668569,1.05435819793394e-05,0.305708732922576,0.167594669199843,0.311134559873635,0.381394038187719,0.435522334839013,1.11507435572473,2.85874999746483,7.60878164870346,0.0339453928335334,0.0253536909026642,0.176866464293560; ...
                 0.0879972184929737,0.179952312905229,NaN,0.486776179563874,0.160038515243410,0.199644230769230,0.287461864406780,0.429304357948536,1,NaN,0.408894292179596,1.47314918479977,0.0507424437139441,0.0383745489884828,0.0444201730877574,0.0489285778781332,0.00704784273671337,0.000284081733728946,2.14639540819154e-06,0.347329203601177,0.246976030614224,0.305974412701149,0.419090355407992,0.462438900518407,0.921431893076685,2.65850205158643,11.4995121111641,0.0273852953953847,0.0257737466792989,0.260640510232697; ...
                 0.0687352206940620,0.141542457566271,0.276299436651174,0.472741517875823,0.274251838434039,0.289413486005089,0.327219158200290,0.462511133141746,0.999989699047791,0.707770022108974,0.496859082481084,1.58516214005525,0.0440298292549206,0.0363467100640497,0.0256789724481503,0.0452752073755891,0.00760108832018460,0.000237529125361192,2.98388727674747e-06,0.394139451746839,0.348339138741291,0.287971888321997,0.449490962049890,0.487989076010616,0.562845460747979,2.28145302020562,16.9624217138576,0.0239134648287587,0.0405001018948278,0.357093938527854; ...
                 0.0759040110773336,0.267844160449383,0.143891746960212,0.527477565488849,0.0742117408360598,0.275093333333333,0.277000000000000,0.251461665770139,1,0.744309259509919,0.402606862986695,1.19736007688287,0.0809056052211642,0.0854504405845234,0.0692396805663028,0.0290194277306901,0.00482389480876363,0.000520830269708945,1.10958227521470e-05,0.418882152169166,0.305616818370275,0.343012593678578,0.624218208129770,0.540695581847707,0.508250925284375,1.77639353414287,11.6970869503145,0.0264078822788200,0.0258458336569567,0.312099432419983];
        stds = [0.0280054127388860,0.0336123605904815,NaN,NaN,0.0336123605904815,0.0262622185011666,NaN,0.0515783692402939,0,NaN,NaN,1.61593083466188,0.0214862253131988,0.0287723986212280,0.0235063371506809,0.0488602107087586,0.00579481082548866,0.000150633106893037,1.11855725284951e-05,0.0509941077987319,0.0669725324609669,0.00888551332166901,0.0935827511465831,0.0412482032457763,0.285643183093136,0.518871304651078,2.36186695406680,0.00597701296433012,0.0308930717375751,0.0303727804962491; ...
                0.0234507675819345,0.0321473849302060,NaN,0.0951825845167008,0.273278557269804,0.0663071803615226,0.0946252785511899,0.0681308722558279,0,NaN,0.142156596558797,1.03898863468180,0.0225072057121707,0.0219283723002070,0.0197188166017142,0.0272068567089528,0.00370922949954732,0.000226030434316648,3.15238497674518e-06,0.0523181566117075,0.0725974829290891,0.0245405682125160,0.129959004562266,0.0503979642473591,0.297689007848805,0.761409268491828,2.70920531725998,0.00490591835328339,0.0298734164119505,0.0632293522374413; ...
                0.0121201673338456,0.0317544468835204,0.0501291554513700,0.0715403838322824,0.179545761606972,0.0937212469167397,0.0902899713963598,0.0647702885920180,0.000288794318667954,0.130769680316895,0.133531260510190,0.703335076025833,0.0169308333021901,0.0175400583865368,0.0142800781367078,0.0167166091285399,0.00276191777282181,0.000135702649977571,2.11652803596217e-05,0.0432028313080333,0.0650740765498201,0.0238850407438086,0.0847507548732206,0.0405106973530021,0.247880733790276,0.435623648122642,3.62320315426537,0.00320781501086411,0.0432100605411497,0.0648634989402472; ...
                0.0182087037650068,0.0454697212523175,0.0341341652364372,0.0935391427695828,0.259871875508419,0.0478672639175768,0.0518755218522364,0.0983891606587480,0,0.0994740610428486,0.0848649714437679,0.551024424878191,0.0420091169325367,0.0166932652354856,0.0112833809874949,0.0142067285755948,0.00188917461740138,0.000548410962159834,1.69181116814406e-05,0.0386297159796628,0.0579203605600383,0.00923184533573107,0.0522478872394107,0.0291162390925491,0.126754692418751,0.141025327257137,1.69058253257246,0.00300787879841646,0.0279063934144476,0.0502083229433229];
        stds = stds / 2;
        
        Feat_diff = feat;
        i = feat(31); % category
        Feat_diff(:,1:30) = max(0,abs(Feat_diff(:,1:30) - means(i,:))./stds(i,:)-2);

        Feat_diff_norm = Feat_diff;
        Feat_diff_norm(:,1:30) = 5-(abs(Feat_diff_norm(:,1:30))); % Scaling to 1 - 5 
        Feat_diff_norm(Feat_diff_norm < 0) = 0;

        % Weigths of the normalized features - defined during training
        coefs = [0.40,0.34,0.31,0.37,0.18,0.26,0.31,0.36,0.16,0.19,0.29,0.38,0.41,0.29,0.28,0.31,0.36,0.19,0.07,0.53,0.56,0.38,0.32,0.48,0.54,0.21,0.35,0.40,0.64,0.36];

        %needed_features = [2, 4, 5, 7, 10, 11, 12, 13, 17, 18, 20, 21, 28];
        not_needed_features = [5,6,9,10,11,14,15,18,19,26];

        coefst = coefs.^2;
        coefst(not_needed_features) = 0;
    
        % NB-SQI of the period
        out = sum((coefst./sum(coefst)).*Feat_diff_norm(:,1:30),2,'omitnan');

    end
end